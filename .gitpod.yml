# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image:
  file: .gitpod.Dockerfile

tasks:
  - name: Dependencies & Database
    init: |
      (
        set -e
        npm install 
        npm run supabase:start
        export SUPABASE_API_URL="$(supabase status -o env | sed -n 's/^API_URL=//p' | tr -d '"')"
        export SUPABASE_ANON_KEY="$(supabase status -o env | sed -n 's/^ANON_KEY=//p' | tr -d '"')"
        printf "SUPABASE_API_URL=\"$SUPABASE_API_URL\"\nSUPABASE_ANON_KEY=\"$SUPABASE_ANON_KEY\"" > .env.local
        gp sync-done setup
      )
    env:
      SUPABASE_ACCESS_TOKEN: $SUPABASE_TOKEN_PERSONAL # Update this to the name of the token you created in the gitpod user settings.

  - name: Webserver
    init: gp sync-await setup
    command: npm run dev
