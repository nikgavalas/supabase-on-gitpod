# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart

image:
  file: .gitpod.Dockerfile

tasks:
  - name: Dependencies & Database
    init: |
      (
        set -e
        npm install 
        npm run supabase:start
        supabase status -o env | sed 's/^/SUPABASE_/' > .env
        SUPABASE_DB_URL="$(supabase status -o env | sed -n 's/^DB_URL=//p' | tr -d '"')"
        SUPABASE_POOLING_URL=$(echo "$SUPABASE_DB_URL" | sed "s/:54322/:6543/g")"?pgbouncer=true"
        printf "SUPABASE_POOLING_URL=\"$SUPABASE_POOLING_URL\"\n" >> .env
        gp sync-done setup
      )
    env:
      SUPABASE_ACCESS_TOKEN: $SUPABASE_TOKEN_PERSONAL # Update this to the name of the token you created in the gitpod user settings.
    command: supabase status

  - name: Webserver
    init: gp sync-await setup
    command: npm run dev
